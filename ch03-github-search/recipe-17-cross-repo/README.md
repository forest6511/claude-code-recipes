# レシピ17: 複数リポジトリを横断して調査する

GitHub MCPのコード検索機能とClaude Codeのファイル参照を組み合わせて、複数リポジトリにまたがる調査を効率化します。

## 概念

このレシピは設定ファイルではなく、複数リポジトリ横断調査の実践パターンを示すものです。

## 使い方

### 1. GitHub MCPでコード検索

GitHub MCPが接続済みの状態で、組織全体からコード検索を実行します。

```bash
> GitHubで "UserService" を含むファイルをorganization全体から検索してください

> このリポジトリの認証APIを呼び出しているコードを、
  他のリポジトリからも検索してください
```

### 2. 特定リポジトリの直接参照

```bash
> github.com/our-org/auth-service のsrc/routes/auth.tsの内容を見せてください

> our-org/api-gatewayリポジトリのOpenAPI仕様ファイルを読んで、
  エンドポイント一覧をまとめてください
```

### 3. 依存関係分析

```bash
> 以下のリポジトリ間のAPI依存関係を分析してください:
  - our-org/frontend
  - our-org/api-gateway
  - our-org/user-service
  - our-org/payment-service

> user-serviceのAPIスキーマが変更された場合、
  影響を受けるリポジトリとファイルを特定してください
```

### 4. Git Worktreeでの並列調査

複数リポジトリを物理的に並列調査する場合:

```bash
# メインリポジトリで作業中
cd ~/projects/frontend

# 別リポジトリをクローンして調査用セッションを開始
cd ~/projects/auth-service
claude
```

調査用セッションで:

```bash
> このサービスが公開しているAPIエンドポイントの一覧と、
  各エンドポイントのリクエスト/レスポンス型を教えてください
```

### 5. 調査結果の活用

元のリポジトリのセッションに戻って:

```bash
> auth-serviceの /api/v2/users エンドポイントのレスポンス型が変わります。
  フロントエンドで影響を受けるファイルを特定して、
  型定義の更新案を作成してください
```

## 注意点

- コンテキストウィンドウの消費に注意が必要です
- 大規模な調査はサブエージェントに委譲するか、`/compact`で定期的にコンテキストを圧縮してください

## 応用パターン

- **API互換性チェック**: フロントエンドとバックエンドのリポジトリで、API型定義の整合性を自動検証するSkillsを作成（レシピ40参照）
- **マイクロサービスのAPI変更影響分析**: 変更予定のAPIエンドポイントを指定すると、影響を受ける全リポジトリのファイルをリストアップ
- **サブエージェントによる並列調査**: 各リポジトリの調査をサブエージェントに委譲すると、メインのコンテキストを消費せずに複数リポジトリを同時に調査可能（レシピ62参照）
