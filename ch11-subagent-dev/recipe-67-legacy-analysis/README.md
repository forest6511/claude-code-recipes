# レシピ67: レガシーコード分析と移行計画の自動生成

並列調査とチェーンを組み合わせ、レガシーコードの分析から移行計画の生成までを自動化します。3フェーズ（並列調査→統合分析→移行計画生成）のワークフローで、膨大な手動分析を代替します。

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| `.claude/agents/legacy-analyzer.md` | レガシーコード分析と移行計画作成のカスタムサブエージェント定義 |
| `prompts/phase1-parallel-survey.txt` | Phase 1: 並列調査（ファイル構成・技術スタック・品質指標）のプロンプト例 |
| `prompts/phase2-integrated-analysis.txt` | Phase 2: 統合分析（技術的負債の評価と移行難易度マッピング）のプロンプト例 |
| `prompts/phase3-migration-plan.txt` | Phase 3: 移行計画の生成（migration-plan.mdの出力）のプロンプト例 |

## 使い方

```bash
# レガシーコード分析エージェントをプロジェクトに配置
cp -r .claude /path/to/your-project/

# 3フェーズワークフローを実行
> レガシーコードの分析を開始します。以下を並列で調査してください:
> 調査1 - ファイル構成
> 調査2 - 技術スタック
> 調査3 - 品質指標
# （調査結果を確認してから統合分析へ）
> 3つの調査結果を統合し、技術的負債のホットスポットを分析してください
# （統合分析結果を確認してから移行計画生成へ）
> 分析結果を踏まえて、移行計画をmigration-plan.mdとして生成してください
```

## 3フェーズワークフロー

```
Phase 1: 並列調査（複数のExploreサブエージェント）
  +-- [Explore] ファイル構成とモジュール依存関係
  +-- [Explore] 使用技術・フレームワークの特定
  +-- [Explore] テストカバレッジと品質指標

Phase 2: 統合分析（general-purposeサブエージェント）
  +-- Phase 1の結果を統合し、技術的負債の評価

Phase 3: 移行計画の生成（general-purposeサブエージェント）
  +-- 段階的な移行計画をドキュメントとして出力
```

## 設計のポイント

- **並列調査で偏りのない全体像を把握する**: 手動分析では特定モジュールに注目しすぎて全体の依存関係を見落とす傾向がある
- **低リスクモジュールから着手する方針**: テストがあり依存が少ないモジュールから移行し、プロセスの知見を蓄積する
- **memory: projectで移行進捗を長期追跡**: 「前回どこまで移行したか」を自動的に把握し、次のPhaseから再開できる
- **移行計画のPhaseをサブエージェントで順次実行**: Phase完了ごとに人間が検証する半自動移行ワークフローを構築可能

## 関連レシピ

- レシピ62「並列実行で大規模コードベースを高速調査する」
- レシピ64「Prompt Chainingと中間ゲート設計」
- レシピ61「永続メモリパターン」
