# レシピ66: サブエージェント駆動のコードレビュー

コードレビュー専用のカスタムサブエージェントを定義し、永続メモリ（`memory: project`）でプロジェクト固有のレビュー知見を蓄積します。一貫したレビュー基準と、回を重ねるごとに精度が向上する学習するレビューを実現します。

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| `.claude/agents/code-reviewer.md` | コード品質とセキュリティのレビュー専用サブエージェント定義 |
| `prompts/review-request.txt` | コードレビューの依頼・修正・再レビューのプロンプト例 |
| `prompts/parallel-review.txt` | 複数の観点（セキュリティ/パフォーマンス/アーキテクチャ）を並列レビューするプロンプト例 |
| `memory-example.md` | 永続メモリ（MEMORY.md）の蓄積例 |

## 使い方

```bash
# レビューエージェントをプロジェクトに配置
cp -r .claude /path/to/your-project/

# レビューの依頼
> 最近の変更をレビューしてください

# Critical指摘の修正
> Critical指摘を修正してください

# 修正後の再レビュー（前回のコンテキストを保持）
> 修正が完了しました。再レビューしてください
```

## レビュー出力の優先度

| 優先度 | 説明 | 例 |
|--------|------|----|
| Critical（必ず修正） | セキュリティ脆弱性、データ損失リスク | SQLインジェクション、認証の不備 |
| Warning（修正推奨） | パフォーマンス問題、可読性低下 | N+1クエリ、不要な再レンダリング |
| Suggestion（改善提案） | より良い実装の提案 | 命名改善、パターン適用 |

## 設計のポイント

- **descriptionに「積極的に使用する」を含める**: コード変更後にClaude Codeがこのサブエージェントを自動選択する確率が高まる
- **memory: projectでチーム共有**: バージョン管理に含められるため、レビュー知見をチーム全体で共有できる
- **再開機能で差分レビュー**: 修正前のレビュー結果を保持したまま再レビューし、指摘箇所の修正確認が効率的
- **並列レビューで多角的チェック**: 観点ごとに別のサブエージェントを起動し、各観点に集中した深いレビューが可能

## 関連レシピ

- レシピ59「カスタムエージェントを定義する」
- レシピ61「永続メモリパターン」
- レシピ82「SubagentStart/SubagentStopフックで制御する」
