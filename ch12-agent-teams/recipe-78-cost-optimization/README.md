# レシピ78: コスト最適化パターン --- 18.75倍のモデル価格差を活かす

Opus、Sonnet、Haikuの価格差を理解し、タスクの性質に応じてモデルを使い分けてコストを最適化します。Agent Teamsでのコスト管理ポイントも解説します。

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| `.claude/agents/researcher.md` | Haikuモデルの低コスト調査エージェント |
| `.claude/agents/implementer.md` | Sonnetモデルのバランス型実装エージェント |
| `prompts/cost-tips.txt` | コスト監視と管理のTIPS |

## 使い方

```bash
# コスト最適化されたエージェント定義をコピー
cp -r .claude /path/to/your-project/

# セッション中のコスト確認
/cost

# コスト表示例
# Total cost:            $0.55
# Total duration (API):  6m 19.7s
# Total duration (wall): 6h 33m 10.2s
```

## モデル価格比較（API利用時、執筆時点の概算）

| モデル | 入力トークン | 出力トークン | Opus比 |
|--------|-------------|-------------|--------|
| Opus 4.6 | $15/MTok | $75/MTok | 1x |
| Sonnet 4.5 | $3/MTok | $15/MTok | 1/5 |
| Haiku 4.5 | $0.80/MTok | $4/MTok | 1/18.75 |

## タスク別のモデル選択指針

| モデル | 適するタスク |
|--------|-------------|
| Haiku | ファイル検索、構文チェック、テスト結果解析、ドキュメント生成 |
| Sonnet | バグ修正、コードレビュー、テスト作成、リファクタリング |
| Opus | アーキテクチャ設計、大規模リファクタリング計画、セキュリティ分析 |

## Agent Teamsのコスト管理

1. **チームサイズを最小限に**: トークン使用量はチームサイズにほぼ比例
2. **チームメイトにSonnetを使用**: Opusの1/5コストで十分な能力
3. **spawn promptを簡潔に**: 追加情報はコンテキストの初期コストを増加
4. **作業完了後にクリーンアップ**: アイドル状態のチームメイトもトークンを消費

## 関連レシピ

- レシピ09「モデル選択戦略」
- レシピ10「トークン消費を削減するプロンプトテクニック」
- レシピ73「Routingパターン」
