# レシピ76: Map-Reduceパターン --- 並列処理・集約・Voting（合議）の応用

Map-ReduceパターンとVoting（合議）パターンをClaude Codeのサブエージェントとエージェントチームで実装します。Anthropicの「Building Effective Agents」に基づく設計パターンです。

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| `prompts/map-reduce.txt` | Map-Reduceパターンの実践プロンプト例（ファイル並列分析） |
| `prompts/voting.txt` | Voting（合議）パターンの実践プロンプト例（競争的仮説テスト） |
| `prompts/combined.txt` | Map + Votingの組み合わせパターン |

## 使い方

```bash
# Map-Reduce: ディレクトリ単位で並列分析
> src/ ディレクトリ内の全TypeScriptファイルを分析して、
> 型安全性の問題を報告してください。
> 以下のように並列で分析してください:
> 1. src/api/ と src/services/ を1つのサブエージェントで分析
> 2. src/components/ と src/hooks/ を別のサブエージェントで分析
> 3. src/utils/ と src/types/ をさらに別のサブエージェントで分析

# Voting: 競争的仮説テスト
> バグの根本原因を調査します。エージェントチームを作成して、
> 5人のチームメイトにそれぞれ異なる仮説で調査させてください。
```

## パターン構造

```
Map-Reduce:
  Map（並列処理）:
    ├─ サブエージェント1: ファイルグループAを処理
    ├─ サブエージェント2: ファイルグループBを処理
    └─ サブエージェント3: ファイルグループCを処理
  Reduce（集約）:
    └─ メインの会話: 結果を統合して最終レポートを作成

Voting（合議）:
  独立分析:
    ├─ エージェントA: 独自にソリューションを提案
    ├─ エージェントB: 独自にソリューションを提案
    └─ エージェントC: 独自にソリューションを提案
  合議:
    └─ 共通点を採用（2つ以上が同じ結論 → 高い信頼性）
```

## 設計のポイント

- Map-Reduceは3〜5分割が適切なバランス
- Votingは3エージェントで十分な精度
- 並列数を増やすほどコストも比例して増加する

## 関連レシピ

- レシピ62「並列実行で大規模コードベースを高速調査する」
- レシピ90「Stop Hooksでタスク完了を自動検証する」
- レシピ64「Prompt Chainingと中間ゲート設計」
