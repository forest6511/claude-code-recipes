# レシピ73: Routingパターン --- 入力の複雑度でモデル・エージェントを振り分ける

タスクの複雑度を判定し、適切なモデルやエージェントにルーティングするパターンを構築します。Anthropicの「Building Effective Agents」で紹介されているワークフローパターンの1つです。

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| `.claude/agents/quick-task.md` | Haikuモデルの高速タスク処理エージェント（ファイル検索、構文チェック、フォーマット） |
| `.claude/agents/standard-task.md` | Sonnetモデルのバランス型エージェント（バグ修正、テスト作成、コードレビュー） |
| `prompts/routing-examples.txt` | 明示的なルーティング指示のプロンプト例 |

## 使い方

```bash
# エージェント定義をプロジェクトにコピー
cp -r .claude /path/to/your-project/

# Claude Codeが自動ルーティング
# descriptionに基づいて最適なエージェントを自動選択する

# 明示的に指定する場合
> src/utils/の型定義エラーを検出して。quick-taskエージェントを使って
> ログイン機能のバグを修正して。standard-taskエージェントを使って
```

## ルーティング構造

```
ルーター（メインの会話 or リーダー）
  │
  ├─ 簡単なタスク → Haikuサブエージェント
  │   例: ファイル検索、型チェック、リンター実行
  │
  ├─ 中程度のタスク → Sonnetサブエージェント
  │   例: バグ修正、コードレビュー、テスト作成
  │
  └─ 複雑なタスク → Opusで直接実行 or Agent Teams
      例: アーキテクチャ設計、大規模リファクタリング
```

## 設計のポイント

- `description`に「積極的に使用する」を含めるとClaude Codeがそのサブエージェントを選択する確率が高まる
- 迷う場合は上位モデルに振り分ける方が安全（誤ルーティングの再作業コスト > モデルコスト差）
- CLAUDE.mdにルーティングガイドラインを記述するとプロジェクト全体で一貫した振り分けになる

## 関連レシピ

- レシピ58「エージェント種別を使い分ける」
- レシピ78「コスト最適化パターン」
- レシピ09「モデル選択戦略」
