---
name: refactor
description: コードのリファクタリングを計画・実行する。コードの改善、技術的負債の解消に使用する。
argument-hint: [file-or-function]
disable-model-invocation: true
allowed-tools: Read, Write, Edit, Glob, Grep, Bash(npm test *), Bash(npx jest *), Bash(npx vitest *), Bash(pytest *), Bash(go test *)
---

# リファクタリング

## 対象
$ARGUMENTS

## ステップ1: 現状分析

対象のコードを読み取り、以下の観点で分析してください。

### コードスメル検出
- **長すぎる関数**: 30行以上の関数を特定
- **深いネスト**: 3段以上のネストを特定
- **重複コード**: 類似するロジックの繰り返し
- **巨大なクラス/モジュール**: 複数の責務を持つコード
- **長すぎるパラメータリスト**: 4つ以上のパラメータ
- **マジックナンバー/文字列**: 定数化されていないリテラル

### 分析結果の出力形式

| コードスメル | ファイル:行 | 深刻度 | 推奨手法 |
|------------|-----------|--------|---------|
| ... | ... | HIGH/MEDIUM/LOW | Extract Method / Rename / ... |

## ステップ2: リファクタリング計画

分析結果に基づき、以下の順序で計画を策定してください。

1. テストの確認（既存テストが通ることを確認）
2. 変更の優先順位付け（深刻度順）
3. 各変更の具体的な手順
4. 影響を受ける他のファイルの特定

## ステップ3: 実行

計画に従い、1つずつリファクタリングを実施してください。

- 変更ごとにテストを実行する
- テストが失敗したら、直前の変更を取り消す
- 全てのテストが通る状態を常に維持する

## ステップ4: 結果報告

| 変更内容 | ファイル | 手法 | テスト結果 |
|---------|--------|------|-----------|
| ... | ... | Extract Method | PASS |
